import{c as A,r,a7 as L,a8 as F,a9 as U,d as v,j as e,aa as N,g as z,X as q,b as I,V as D,a6 as W,f as H,ab as O,v as V,a as $}from"./index-BewSTdif.js";import{S as G}from"./search-DoIgd_XR.js";import{T as _,a as B}from"./toggle-right-BM37fc1h.js";import"./vendor-B7FnPyzq.js";/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],Y=A("wand-sparkles",X),K=[{value:"equals",label:"Equals (=)"},{value:"contains",label:"Contains"},{value:"startsWith",label:"Starts With"},{value:"endsWith",label:"Ends With"},{value:"notEquals",label:"Not Equals (!=)"},{value:"greaterThan",label:"Greater Than (>)"},{value:"exists",label:"Exists (Not Empty)"}],se=({onClose:p,onSelect:y,initialRawJson:o,initialAutoPath:d})=>{const[w,k]=r.useState([]),[b,C]=r.useState(""),[s,i]=r.useState(null),[Q,g]=r.useState(!1),[c,x]=r.useState(null);r.useEffect(()=>{f()},[]),r.useEffect(()=>{if(s&&o)try{let t=s.collectionPath;t==="<<auto>>"&&(t=d||"");const a=L(o,t);let l=Array.isArray(a)?a:a?[a]:[];if(l=F(l),l.length>0){const m=U(l,s.rules);x(m.length)}else x(0)}catch{x(0)}},[s,o,d]);const f=async()=>{const t=await v.getSourcePlugins();k(t)},S=()=>{const t={id:crypto.randomUUID(),name:"New Filter Set",collectionPath:"<<auto>>",rules:[]};i(t),g(!0)},P=t=>{i({...t}),g(!1)},E=async()=>{!s||!s.name||(await v.saveSourcePlugin(s),await f(),y(s))},T=()=>{if(!s)return;const t={id:crypto.randomUUID(),field:"",operator:"equals",value:""};i({...s,rules:[...s.rules||[],t]})},u=(t,a,l)=>{if(!s)return;const m=(s.rules||[]).map(h=>h.id===t?{...h,[a]:l}:h);i({...s,rules:m})},M=t=>{if(!s)return;const a=(s.rules||[]).filter(l=>l.id!==t);i({...s,rules:a})},n=(s==null?void 0:s.collectionPath)==="<<auto>>",R=()=>{s&&i(n?{...s,collectionPath:""}:{...s,collectionPath:"<<auto>>"})},j=w.filter(t=>t.name.toLowerCase().includes(b.toLowerCase()));return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"w-full max-w-4xl bg-black border border-zinc-800 rounded-xl shadow-2xl overflow-hidden flex h-[80vh]",children:[e.jsxs("div",{className:"w-64 border-r border-zinc-800 bg-zinc-900/50 flex flex-col",children:[e.jsxs("div",{className:"p-4 border-b border-zinc-800",children:[e.jsxs("h3",{className:"text-sm font-bold text-zinc-200 mb-3 flex items-center gap-2",children:[e.jsx(N,{size:16,className:"text-indigo-500"})," Saved Plugins"]}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{size:12,className:"absolute left-2.5 top-2.5 text-zinc-500"}),e.jsx("input",{value:b,onChange:t=>C(t.target.value),placeholder:"Search plugins...",className:"w-full bg-black border border-zinc-800 rounded-lg py-1.5 pl-8 pr-2 text-xs text-white focus:border-indigo-500 outline-none"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-2 space-y-1 custom-scrollbar",children:[j.map(t=>{var a,l;return e.jsxs("button",{onClick:()=>P(t),className:`w-full text-left px-3 py-2 rounded-lg text-xs transition-colors flex items-center justify-between group ${(s==null?void 0:s.id)===t.id?"bg-indigo-600 text-white":"text-zinc-400 hover:bg-zinc-800 hover:text-zinc-200"}`,children:[e.jsx("span",{className:"truncate font-medium",children:t.name}),(((a=t.rules)==null?void 0:a.length)||0)>0&&e.jsx("span",{className:"text-[9px] opacity-70 bg-black/20 px-1.5 rounded",children:(l=t.rules)==null?void 0:l.length})]},t.id)}),j.length===0&&e.jsx("p",{className:"text-center text-[10px] text-zinc-600 py-4",children:"No saved plugins."})]}),e.jsx("div",{className:"p-4 border-t border-zinc-800",children:e.jsxs("button",{onClick:S,className:"w-full flex items-center justify-center gap-2 bg-zinc-800 hover:bg-zinc-700 text-zinc-200 py-2 rounded-lg text-xs font-bold transition-colors border border-zinc-700",children:[e.jsx(z,{size:14})," Create New Plugin"]})})]}),e.jsxs("div",{className:"flex-1 bg-zinc-950 flex flex-col min-w-0 relative",children:[e.jsx("button",{onClick:p,className:"absolute top-4 right-4 text-zinc-500 hover:text-white p-2 z-20",children:e.jsx(q,{size:20})}),s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-6 border-b border-zinc-800 space-y-6 pr-12",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-bold text-zinc-500 uppercase",children:"Plugin Name"}),e.jsx("input",{value:s.name,onChange:t=>i({...s,name:t.target.value}),className:"w-full bg-transparent text-xl font-bold text-white outline-none placeholder:text-zinc-700",placeholder:"Untitled Filter Set"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"text-[10px] font-bold text-zinc-500 uppercase flex items-center gap-1",children:[e.jsx(I,{size:12})," Data Location (Array Source)"]}),e.jsxs("button",{onClick:R,className:`flex items-center gap-1.5 text-[10px] font-bold transition-colors ${n?"text-emerald-400":"text-zinc-500"}`,children:[n?"Auto-Detect":"Manual Path",n?e.jsx(_,{size:20}):e.jsx(B,{size:20})]})]}),n?e.jsxs("div",{className:"flex items-start gap-3 p-3 bg-emerald-500/10 border border-emerald-500/20 rounded-lg",children:[e.jsx(Y,{size:16,className:"text-emerald-500 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-emerald-100",children:"Using Auto-Detected List"}),e.jsxs("p",{className:"text-[10px] text-emerald-400/70 mb-2",children:["This plugin will dynamically use the list found during import.",e.jsx("br",{}),"Current detection: ",e.jsx("span",{className:"font-mono bg-emerald-900/50 px-1 rounded",children:d||"root"})]}),e.jsx("div",{className:"pt-2 border-t border-emerald-500/20",children:e.jsxs("p",{className:"text-[10px] text-emerald-200",children:[e.jsx("strong",{children:"How to Filter:"})," Just use the field name (e.g. ",e.jsx("code",{children:"title"}),").",e.jsx("br",{}),"Smart Unwrapping is active: You do NOT need to prefix (e.g. ",e.jsx("code",{children:"article.title"}),").",e.jsx("br",{}),"The system automatically detects wrapper objects and flattens them for you."]})})]})]}):e.jsx("div",{className:"flex gap-2",children:e.jsx("input",{value:s.collectionPath,onChange:t=>i({...s,collectionPath:t.target.value}),className:"flex-1 bg-zinc-900 border border-zinc-800 rounded px-3 py-2 text-xs text-indigo-300 font-mono focus:border-indigo-500 outline-none",placeholder:"e.g. data.items"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 custom-scrollbar bg-black/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"text-sm font-bold text-zinc-300 flex items-center gap-2",children:[e.jsx(D,{size:16})," Filtering Rules"]}),e.jsxs("button",{onClick:T,className:"text-xs text-indigo-400 hover:text-indigo-300 flex items-center gap-1",children:[e.jsx(z,{size:12})," Add Rule"]})]}),e.jsxs("div",{className:"space-y-3",children:[(s.rules||[]).length===0&&e.jsxs("div",{className:"text-center py-10 border-2 border-dashed border-zinc-800 rounded-xl",children:[e.jsx("p",{className:"text-zinc-600 text-xs",children:"No specific rules defined."}),e.jsx("p",{className:"text-zinc-700 text-[10px] mt-1",children:"All items in the list will be imported."})]}),(s.rules||[]).map((t,a)=>e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-zinc-900 border border-zinc-800 rounded-xl animate-in slide-in-from-left-2 group hover:border-zinc-700 transition-colors",children:[e.jsx("div",{className:"text-zinc-700 cursor-move",children:e.jsx(W,{size:14})}),e.jsx("div",{className:"text-xs font-mono text-zinc-500 w-6 text-center",children:a+1}),e.jsx("div",{className:"flex-1 min-w-[120px]",children:e.jsx("input",{value:t.field,onChange:l=>u(t.id,"field",l.target.value),placeholder:"Property (e.g. category)",className:"w-full bg-black border border-zinc-700 rounded px-2 py-1.5 text-xs text-white focus:border-indigo-500 outline-none"})}),e.jsx("div",{className:"w-[140px]",children:e.jsx("select",{value:t.operator,onChange:l=>u(t.id,"operator",l.target.value),className:"w-full bg-black border border-zinc-700 rounded px-2 py-1.5 text-xs text-zinc-300 focus:border-indigo-500 outline-none",children:K.map(l=>e.jsx("option",{value:l.value,children:l.label},l.value))})}),e.jsx("div",{className:"flex-1 min-w-[120px]",children:e.jsx("input",{value:t.value,disabled:t.operator==="exists",onChange:l=>u(t.id,"value",l.target.value),placeholder:t.operator==="exists"?"N/A":"Value to match",className:"w-full bg-black border border-zinc-700 rounded px-2 py-1.5 text-xs text-white focus:border-indigo-500 outline-none disabled:opacity-50 disabled:bg-zinc-900"})}),e.jsx("button",{onClick:()=>M(t.id),className:"p-1.5 text-zinc-600 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(H,{size:14})})]},t.id))]})]}),e.jsxs("div",{className:"p-4 border-t border-zinc-800 bg-zinc-900/50 flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:c!==null?e.jsxs("span",{className:`text-xs px-2 py-1 rounded border flex items-center gap-2 ${c>0?"bg-emerald-500/10 text-emerald-400 border-emerald-500/20":"bg-red-500/10 text-red-400 border-red-500/20"}`,children:[c>0?e.jsx(O,{size:12}):e.jsx(V,{size:12}),"Preview Match: ",e.jsx("strong",{children:c})," Items"]}):e.jsx("span",{className:"text-xs text-zinc-500 italic",children:"No sample data available for preview."})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:p,className:"px-4 py-2 text-zinc-400 hover:text-white text-xs font-bold transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:E,className:"flex items-center gap-2 px-6 py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg text-xs font-bold transition-all shadow-lg shadow-indigo-900/20",children:[e.jsx($,{size:14}),"Save Plugin"]})]})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-zinc-600",children:[e.jsx(N,{size:48,className:"opacity-20 mb-4"}),e.jsx("p",{className:"text-sm",children:"Select a plugin or create a new one."})]})]})]})})};export{se as default};
