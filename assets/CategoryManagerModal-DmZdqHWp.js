const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Palette-CGYLplIa.js","assets/index-BewSTdif.js","assets/vendor-B7FnPyzq.js"])))=>i.map(i=>d[i]);
import{r,j as e,X as M,Q as F,L as A,m as w,s as g,E as O,n as R,W as B,h as H,f as K,d as j,_ as V}from"./index-BewSTdif.js";import{S as G}from"./search-DoIgd_XR.js";import"./vendor-B7FnPyzq.js";const Q=w.lazy(()=>V(()=>import("./Palette-CGYLplIa.js"),__vite__mapDeps([0,1,2]))),U=({onClose:k,onUpdate:u})=>{const[o,p]=r.useState([]),[C,_]=r.useState([]),[n,S]=r.useState(null),[d,y]=r.useState(""),[b,c]=r.useState("folder"),[f,x]=r.useState(void 0),[m,N]=r.useState("indigo"),[E,h]=r.useState(null),[$,I]=r.useState(!1);r.useEffect(()=>{(async()=>{const[s,a]=await Promise.all([j.getCategories(),j.getNotes()]);p(s),_(a)})(),v("folder")},[]);const v=async t=>{if(t){I(!0);try{const s=await fetch(`https://unpkg.com/lucide-static@latest/icons/${t.toLowerCase()}.svg`);if(!s.ok)throw new Error("Icon not found");const i=(await s.text()).replace(/width="\d+"/,'width="1.2em"').replace(/height="\d+"/,'height="1.2em"').replace(/stroke="[^"]+"/,'stroke="currentColor"');x(i),c(t.toLowerCase())}catch{x(void 0),c(t.toLowerCase())}finally{I(!1)}}},L=t=>{c(t),x(void 0)},z=()=>{y(""),c("folder"),x(void 0),N("indigo"),S(null),h(null),v("folder")},D=async()=>{if(!d.trim())return;if(h(null),o.some(l=>l.name.toLowerCase()===d.toLowerCase()&&(n?l.id!==n:!0))){h("Category name already exists.");return}const s=o.find(l=>l.id===n),a=(s==null?void 0:s.isSystem)||!1,i={id:n||`cat_${crypto.randomUUID()}`,name:d,icon:b,svgData:f,color:m,isSystem:a};await j.saveCategory(i),p(n?o.map(l=>l.id===n?i:l):[...o,i]),z(),u&&u()},P=t=>{S(t.id),y(t.name),c(t.icon),x(t.svgData),N(t.color),h(null)},T=async t=>{const s=o.find(i=>i.id===t);if(s!=null&&s.isSystem){h("Cannot delete system categories.");return}const a=C.filter(i=>i.categoryId===t).length;a>0&&!confirm(`This category is used by ${a} notes. Deleting it will leave them uncategorized. Continue?`)||(t===n&&z(),await j.deleteCategory(t),p(o.filter(i=>i.id!==t)),u&&u())};return e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm animate-in fade-in duration-200",children:e.jsxs("div",{className:"w-full max-w-sm bg-zinc-900 border border-zinc-800 rounded-xl shadow-2xl overflow-hidden animate-in zoom-in-95 duration-200 flex flex-col max-h-[85vh]",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-zinc-800 bg-zinc-900/50 shrink-0",children:[e.jsx("h3",{className:"text-sm font-bold text-white",children:"Manage Categories"}),e.jsx("button",{onClick:k,className:"text-zinc-500 hover:text-white transition-colors",children:e.jsx(M,{size:16})})]}),e.jsxs("div",{className:"p-6 pt-2 space-y-6 flex-1",children:[E&&e.jsxs("div",{className:"flex items-center gap-2 text-[10px] text-red-400 bg-red-500/10 p-2 rounded border border-red-500/20",children:[e.jsx(F,{size:12})," ",E]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-zinc-500",children:n?"Edit Name":"Name"}),e.jsx("input",{value:d,onChange:t=>y(t.target.value),className:"w-full bg-black border border-zinc-700 rounded p-2 text-xs text-white focus:border-indigo-500 outline-none",placeholder:"Category Name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-zinc-500",children:"Icon (Lucide)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("input",{type:"text",value:b,onChange:t=>c(t.target.value),onBlur:t=>v(t.target.value),onKeyDown:t=>t.key==="Enter"&&v(t.currentTarget.value),className:"w-full bg-black border border-zinc-700 rounded p-2 pl-8 text-xs text-white focus:border-indigo-500 outline-none",placeholder:"e.g. home, settings, user"}),e.jsx(G,{size:12,className:"absolute left-2.5 top-2.5 text-zinc-500"})]}),e.jsx("div",{className:`w-9 h-9 rounded border border-zinc-700 bg-zinc-900 flex items-center justify-center text-${m}-500`,children:$?e.jsx(A,{size:16,className:"animate-spin text-zinc-500"}):f?e.jsx("span",{dangerouslySetInnerHTML:{__html:f},className:"flex items-center justify-center w-5 h-5"}):w.createElement(g[b]||g.FolderKanban,{size:16})})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("p",{className:"text-[12px] text-zinc-500",children:["Browse icons at ",e.jsxs("a",{href:"https://lucide.dev/icons",target:"_blank",rel:"noopener noreferrer",className:"text-indigo-400 hover:text-indigo-300 hover:underline inline-flex items-center gap-0.5",children:["lucide.dev ",e.jsx(O,{size:10})]})," and paste the name above."]})}),e.jsxs("div",{className:"space-y-1 mt-4",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-zinc-500 mb-1",children:"Common Presets"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:Object.keys(g).map(t=>{const s=g[t],a=b===t&&!f;return e.jsx("button",{onClick:()=>L(t),className:`p-1 rounded border transition-colors ${a?`bg-${m}-500 text-white border-${m}-500`:"border-zinc-800 text-zinc-500 hover:bg-zinc-800"}`,title:t,children:e.jsx(s,{size:16})},t)})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-zinc-500",children:"Color Theme"}),e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"h-20 bg-zinc-900 animate-pulse ring-1 ring-indigo-500 rounded"}),children:e.jsx(Q,{selectedColor:m,onSelect:N})})]}),e.jsxs("div",{className:"flex gap-2",children:[n&&e.jsx("button",{onClick:z,className:"px-4 py-2 bg-zinc-800 text-zinc-400 hover:text-white rounded text-xs font-bold transition-colors",children:"Cancel"}),e.jsx("button",{onClick:D,disabled:!d.trim(),className:`flex-1 py-2 text-white rounded text-xs font-bold disabled:opacity-50 transition-colors shadow-lg ${n?"bg-emerald-600 hover:bg-emerald-500 shadow-emerald-900/20":"bg-indigo-600 hover:bg-indigo-500 shadow-indigo-900/20"}`,children:n?"Update Category":"Create Category"})]})]}),e.jsxs("div",{className:"border-t border-zinc-800 pt-4",children:[e.jsx("h4",{className:"text-[10px] uppercase font-bold text-zinc-500 mb-3",children:"Existing Categories"}),e.jsx("div",{className:"max-h-48 overflow-y-auto px-2 space-y-1",children:o.map(t=>{const s=C.filter(i=>i.categoryId===t.id).length,a=t.id===n;return e.jsxs("div",{className:`flex items-center justify-between p-2 bg-zinc-950 border border-zinc-800 rounded transition-colors group ${a?"bg-indigo-500/10 border-indigo-500/30":"bg-zinc-950/50 border-zinc-800 hover:border-zinc-700"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`text-${t.color}-500 w-5 h-5 flex items-center justify-center`,children:t.svgData?e.jsx("span",{dangerouslySetInnerHTML:{__html:t.svgData}}):w.createElement(g[t.icon]||R,{size:16})}),e.jsxs("span",{className:`text-xs font-medium ${a?"text-indigo-300":`text-${t.color}-500`}`,children:[t.name," ",t.isSystem&&e.jsx("span",{className:"text-[9px] opacity-50 ml-1",children:"(System)"})]}),s>0&&e.jsx("span",{className:"text-[9px] bg-zinc-900 text-zinc-500 px-1.5 py-0.5 rounded-full border border-zinc-800",children:s})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>P(t),className:`text-zinc-600 hover:text-indigo-400 mr-2 transition-opacity ${a?"opacity-100 text-indigo-400":"opacity-0 group-hover:opacity-100"}`,title:"Edit",children:e.jsx(B,{size:14})}),t.isSystem?e.jsx("span",{title:"System Category (Protected)",children:e.jsx(H,{size:14,className:"text-zinc-700 opacity-50 cursor-not-allowed"})}):e.jsx("button",{onClick:()=>T(t.id),className:`text-zinc-600 hover:text-red-400 transition-opacity ${a?"opacity-100":"opacity-0 group-hover:opacity-100"}`,title:"Delete",children:e.jsx(K,{size:14})})]})]},t.id)})})]})]})]})})};export{U as default};
