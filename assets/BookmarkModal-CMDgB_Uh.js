const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Toast-v5_KOnQT.js","assets/index-KKYn1hr3.js","assets/vendor-B7FnPyzq.js","assets/index-DyUq36P8.css"])))=>i.map(i=>d[i]);
import{d as y,r as o,j as e,G as W,X,L as J,v as K,R as Q,F as Y,T as Z,o as B,a as k,m as ee,_ as te}from"./index-KKYn1hr3.js";import"./vendor-B7FnPyzq.js";const C={shuffle:a=>{let n=a.length,t;for(;n!==0;)t=Math.floor(Math.random()*n),n--,[a[n],a[t]]=[a[t],a[n]];return a},constructUrl:(a,n)=>{const t=a.trim();return t.endsWith("=")?t+encodeURIComponent(n):`${t.replace(/\/$/,"")}/${n}`},fetch:async(a,n={})=>{const l=((await y.getSettings()).proxyConfigs||[]).filter(c=>c.enabled);if(l.length===0)return console.log("[ProxyService] No proxies configured. Attempting direct fetch."),fetch(a,n);const j=C.shuffle([...l]);let i=null;for(const c of j)try{const d=C.constructUrl(c.url,a),f=new Headers(n.headers);c.token&&f.set("Authorization",c.token),console.log(`[ProxyService] Trying: ${c.name}`);const h=await fetch(d,{...n,headers:f});if(!h.ok)throw new Error(`Proxy ${c.name} returned ${h.status}`);return h}catch(d){console.warn(`[ProxyService] Failed ${c.name}:`,d),i=d}console.warn("[ProxyService] All proxies failed. Trying direct...");try{return await fetch(a,n)}catch{throw new Error(`All fetch attempts failed. Last error: ${i==null?void 0:i.message}`)}}},se=ee.lazy(()=>te(()=>import("./Toast-v5_KOnQT.js"),__vite__mapDeps([0,1,2,3]))),le=({onClose:a,onSave:n,existingBookmark:t})=>{const[l,j]=o.useState((t==null?void 0:t.url)||""),[i,c]=o.useState((t==null?void 0:t.title)||""),[d,f]=o.useState((t==null?void 0:t.description)||""),[h,A]=o.useState((t==null?void 0:t.categoryId)||""),[v,U]=o.useState(new Set((t==null?void 0:t.tags)||[])),[E,_]=o.useState([]),[q,D]=o.useState([]),[z,T]=o.useState(!1),[N,S]=o.useState(null),[L,O]=o.useState(!1),[b,F]=o.useState(null);o.useEffect(()=>{(async()=>{const[r,m,g]=await Promise.all([y.getCategories(),y.getTags(),y.getSettings()]);_(r),D(m),O((g.proxyConfigs||[]).some(w=>w.enabled)),!h&&r.length>0&&A(r[0].id)})()},[]);const P=async(s=!1)=>{var r,m,g,w,$,R;if(l){S(null);try{const u=new URL(l).hostname;if(!i){const p=u.replace("www.","").split(".")[0];c(p.charAt(0).toUpperCase()+p.slice(1))}}catch{return}if(!(!s&&i&&d)){T(!0);try{const p=await(await C.fetch(l)).text(),x=new DOMParser().parseFromString(p,"text/html"),I=((r=x.querySelector("title"))==null?void 0:r.textContent)||((m=x.querySelector('meta[property="og:title"]'))==null?void 0:m.getAttribute("content"))||((g=x.querySelector('meta[name="twitter:title"]'))==null?void 0:g.getAttribute("content")),M=((w=x.querySelector('meta[name="description"]'))==null?void 0:w.getAttribute("content"))||(($=x.querySelector('meta[property="og:description"]'))==null?void 0:$.getAttribute("content"))||((R=x.querySelector('meta[name="twitter:description"]'))==null?void 0:R.getAttribute("content"));I&&(!i||s)&&c(I.trim()),M&&(!d||s)&&f(M.trim())}catch(u){console.warn("Failed to fetch metadata via proxy",u);let p="Fetch failed";u.message.includes("Failed to fetch")?(p="CORS Error",L||F({show:!0,msg:"Proxy Required",sub:"Add a proxy in Settings to fetch metadata from external sites.",type:"warning"})):u.message.includes("Proxy")&&(p=u.message),S(p)}finally{T(!1)}}}},G=s=>{try{return`https://www.google.com/s2/favicons?domain=${new URL(s).hostname}&sz=128`}catch{return""}},H=s=>{const r=new Set(v);r.has(s)?r.delete(s):r.add(s),U(r)},V=s=>{if(s.preventDefault(),!l||!i)return;const r={id:(t==null?void 0:t.id)||`bm_${crypto.randomUUID()}`,url:l,title:i,description:d,faviconUrl:G(l),categoryId:h,tags:Array.from(v),isFavorite:(t==null?void 0:t.isFavorite)||!1,createdAt:(t==null?void 0:t.createdAt)||Date.now()};n(r)};return e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm animate-in fade-in duration-200",children:[e.jsx(o.Suspense,{fallback:null,children:b&&b.show&&e.jsx(se,{message:b.msg,subMessage:b.sub,type:b.type,onClose:()=>F(null)})}),e.jsxs("div",{className:"w-full max-w-lg bg-zinc-900 border border-zinc-800 rounded-xl shadow-2xl overflow-hidden flex flex-col animate-in zoom-in-95 duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-zinc-800 bg-zinc-900/50",children:[e.jsxs("h3",{className:"text-sm font-bold text-white flex items-center gap-2",children:[e.jsx(W,{size:16,className:"text-indigo-400"}),t?"Edit Bookmark":"New Bookmark"]}),e.jsx("button",{onClick:a,className:"text-zinc-500 hover:text-white transition-colors",children:e.jsx(X,{size:18})})]}),e.jsxs("form",{onSubmit:V,className:"p-6 space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center h-4",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-zinc-500",children:"URL"}),z&&e.jsxs("span",{className:"text-[10px] text-indigo-400 flex items-center gap-1",children:[e.jsx(J,{size:10,className:"animate-spin"})," Fetching Meta..."]}),N&&e.jsxs("span",{className:"text-[10px] text-red-400 flex items-center gap-1",children:[e.jsx(K,{size:10})," ",N]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:l,onChange:s=>{j(s.target.value),S(null)},onBlur:()=>P(!1),placeholder:"https://example.com",className:`flex-1 bg-black border rounded-lg p-2 text-xs text-white outline-none ${N?"border-red-900 focus:border-red-500":"border-zinc-700 focus:border-indigo-500"}`,autoFocus:!0}),e.jsx("button",{type:"button",onClick:()=>P(!0),disabled:z||!l,className:"p-2 bg-zinc-800 hover:bg-zinc-700 border border-zinc-700 hover:border-zinc-600 rounded-lg text-zinc-400 hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Fetch Metadata",children:e.jsx(Q,{size:16,className:z?"animate-spin":""})})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-zinc-500",children:"Title"}),e.jsx("input",{value:i,onChange:s=>c(s.target.value),placeholder:"Site Name",className:"w-full bg-black border border-zinc-700 rounded-lg p-2 text-xs text-white focus:border-indigo-500 outline-none"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] uppercase font-bold text-zinc-500",children:"Description (Optional)"}),e.jsx("textarea",{value:d,onChange:s=>f(s.target.value),placeholder:"Brief description...",className:"w-full bg-black border border-zinc-700 rounded-lg p-2 text-xs text-white focus:border-indigo-500 outline-none resize-none h-20"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"text-[10px] uppercase font-bold text-zinc-500 flex items-center gap-1",children:[e.jsx(Y,{size:12})," Category"]}),e.jsx("select",{value:h,onChange:s=>A(s.target.value),className:"w-full bg-black border border-zinc-700 rounded-lg p-2 text-xs text-white focus:border-indigo-500 outline-none",children:E.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-[10px] uppercase font-bold text-zinc-500 flex items-center gap-1",children:[e.jsx(Z,{size:12})," Tags"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:q.map(s=>e.jsx("button",{type:"button",onClick:()=>H(s.id),className:`px-2 py-1 rounded text-[10px] border transition-all ${v.has(s.id)?`${B[s.color]}`:"border-zinc-800 bg-zinc-900 text-zinc-500 hover:border-zinc-700"}`,children:s.name},s.id))})]}),e.jsxs("div",{className:"pt-4 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 text-zinc-400 hover:text-white text-xs font-bold",children:"Cancel"}),e.jsxs("button",{type:"submit",disabled:!l||!i,className:"flex items-center gap-2 px-6 py-2 bg-indigo-600 hover:bg-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed text-white rounded-lg text-xs font-bold transition-all shadow-lg shadow-indigo-900/20",children:[e.jsx(k,{size:14}),"Save Bookmark"]})]})]})]})]})};export{le as default};
