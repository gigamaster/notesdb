import{c as m,r as n,Y as g,j as e,J as U,n as z,D as v,X as S,d as E,L as w,v as N}from"./index-DboLLwwP.js";import"./vendor-B7FnPyzq.js";/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]],T=m("maximize",P);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],O=m("zoom-in",W);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]],D=m("zoom-out",B),F=({attachmentId:d,onClose:u})=>{const[s,y]=n.useState(null),[a,f]=n.useState(null),[o,h]=n.useState(null),[k,L]=n.useState(!0),[p,C]=n.useState(null),[b,x]=n.useState(1),c=n.useRef(null);n.useEffect(()=>((async()=>{try{if(!d)throw new Error("No attachment ID provided");const t=await E.getAttachment(d);if(!t)throw new Error("Attachment not found");y(t);const i=t.mimeType;if(i.startsWith("image/")||i==="application/pdf"||i.startsWith("video/")||i.startsWith("audio/")){const r=URL.createObjectURL(t.blob);f(r)}else if(i.startsWith("text/")||i.includes("json")||i.includes("javascript")||i.includes("xml")||/\.(md|ts|tsx|py|java|c|cpp|h|css|scss|sql|sh|yaml|yml)$/i.test(t.fileName))if(t.size>512e3)h("File too large for preview. Please download to view.");else{const r=await t.blob.text();h(r)}else if(i==="text/html"){const r=URL.createObjectURL(t.blob);f(r)}}catch(t){const i=t instanceof Error?t.message:String(t);C(i||"Failed to load attachment")}finally{L(!1)}})(),()=>{a&&URL.revokeObjectURL(a)}),[d]),n.useEffect(()=>{o&&c.current&&g.preloadStandard().then(()=>{c.current&&g.highlightBlock(c.current)})},[o]);const j=()=>{if(!s||!s.blob)return;const l=URL.createObjectURL(s.blob),t=document.createElement("a");t.href=l,t.download=s.fileName,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(l)},M=l=>{if(l===0)return"0 B";const t=1024,i=["B","KB","MB","GB"],r=Math.floor(Math.log(l)/Math.log(t));return parseFloat((l/Math.pow(t,r)).toFixed(1))+" "+i[r]},R=()=>{if(k)return e.jsxs("div",{className:"flex flex-col items-center gap-4 text-zinc-500",children:[e.jsx(w,{size:48,className:"animate-spin"}),e.jsx("p",{children:"Loading Preview..."})]});if(p)return e.jsxs("div",{className:"flex flex-col items-center gap-4 text-red-400",children:[e.jsx(N,{size:48}),e.jsx("p",{children:p})]});if(!s)return null;const l=s.mimeType;return l.startsWith("image/")?e.jsxs("div",{className:"relative w-full h-full",children:[e.jsx("div",{className:"w-full h-full overflow-auto flex items-center justify-center p-8 custom-scrollbar",onClick:t=>{t.target===t.currentTarget&&u()},children:e.jsx("img",{src:a,alt:s.fileName,style:{transform:`scale(${b})`,transition:"transform 0.2s",transformOrigin:"center"},className:"max-w-full max-h-full object-contain shadow-2xl rounded-lg bg-zinc-900/50 backdrop-blur-sm",draggable:!1})}),e.jsxs("div",{className:"absolute bottom-8 left-1/2 -translate-x-1/2 flex gap-2 bg-zinc-900/90 border border-zinc-800 rounded-lg p-1 shadow-xl z-20 backdrop-blur-md",children:[e.jsx("button",{onClick:t=>{t.stopPropagation(),x(i=>Math.max(.2,i-.2))},className:"p-2 hover:bg-zinc-800 rounded text-zinc-300",children:e.jsx(D,{size:16})}),e.jsxs("span",{className:"px-2 flex items-center text-xs font-mono text-zinc-500 min-w-[3rem] justify-center",children:[Math.round(b*100),"%"]}),e.jsx("button",{onClick:t=>{t.stopPropagation(),x(i=>Math.min(3,i+.2))},className:"p-2 hover:bg-zinc-800 rounded text-zinc-300",children:e.jsx(O,{size:16})}),e.jsx("button",{onClick:t=>{t.stopPropagation(),x(1)},className:"p-2 hover:bg-zinc-800 rounded text-zinc-300 border-l border-zinc-800 ml-1",children:e.jsx(T,{size:16})})]})]}):o!==null?e.jsxs("div",{className:"w-full max-w-4xl h-full overflow-hidden flex flex-col bg-zinc-900 border border-zinc-800 rounded-xl shadow-2xl my-8",children:[e.jsxs("div",{className:"bg-zinc-950 px-4 py-2 border-b border-zinc-800 flex justify-between items-center text-xs text-zinc-500",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(z,{size:14})," Text Preview"]}),e.jsx("span",{children:s.mimeType})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4 custom-scrollbar bg-zinc-950",children:e.jsx("pre",{className:"text-sm font-mono text-zinc-300",children:e.jsx("code",{ref:c,className:`language-${s.fileName.split(".").pop()||"text"}`,children:o})})})]}):l==="application/pdf"||l==="text/html"?e.jsx("div",{className:"w-full h-full p-8",children:e.jsx("iframe",{src:a,className:"w-full h-full rounded-xl border border-zinc-800 bg-white",title:"Preview",sandbox:l==="text/html"?"allow-same-origin":void 0})}):l.startsWith("video/")?e.jsx("div",{className:"max-w-4xl w-full",children:e.jsx("video",{controls:!0,src:a,className:"w-full rounded-xl shadow-2xl border border-zinc-800 bg-black"})}):l.startsWith("audio/")?e.jsxs("div",{className:"p-12 bg-zinc-900 border border-zinc-800 rounded-xl shadow-2xl flex flex-col items-center gap-6",children:[e.jsxs("div",{className:"w-24 h-24 bg-zinc-800 rounded-full flex items-center justify-center text-indigo-500 shadow-inner",children:[e.jsx(w,{size:40,className:"animate-pulse"})," "]}),e.jsx("h3",{className:"text-zinc-200 font-bold",children:s.fileName}),e.jsx("audio",{controls:!0,src:a,className:"w-80"})]}):e.jsxs("div",{className:"flex flex-col items-center gap-4 text-zinc-500",children:[e.jsx(N,{size:48,className:"opacity-50"}),e.jsx("p",{children:"Preview not available for this file type."}),e.jsxs("button",{onClick:j,className:"px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg text-sm font-bold flex items-center gap-2",children:[e.jsx(v,{size:16})," Download to View"]})]})};return e.jsxs("div",{className:"fixed inset-0 z-[150] bg-black/95 backdrop-blur-sm flex flex-col animate-in fade-in duration-200",children:[e.jsxs("div",{className:"h-16 flex items-center justify-between px-6 border-b border-zinc-800 bg-black/50 shrink-0 z-10",children:[e.jsxs("div",{className:"flex items-center gap-4 min-w-0",children:[e.jsx("div",{className:"p-2 bg-zinc-800 rounded-lg text-zinc-400 shrink-0",children:s!=null&&s.mimeType.startsWith("image/")?e.jsx(U,{size:20}):e.jsx(z,{size:20})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h2",{className:"text-sm font-bold text-zinc-200 truncate pr-4",children:(s==null?void 0:s.fileName)||"Loading..."}),s&&e.jsxs("p",{className:"text-xs text-zinc-500 font-mono flex items-center gap-2",children:[M(s.size)," â€¢ ",s.mimeType]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:j,disabled:!s,className:"p-2 text-zinc-400 hover:text-white hover:bg-zinc-800 rounded-lg transition-colors flex items-center gap-2 text-xs font-bold px-3",children:[e.jsx(v,{size:16})," ",e.jsx("span",{className:"hidden sm:inline",children:"Download"})]}),e.jsx("div",{className:"w-px h-6 bg-zinc-800 mx-1"}),e.jsx("button",{onClick:u,className:"p-2 text-zinc-400 hover:text-white hover:bg-zinc-800 rounded-lg transition-colors",title:"Close (Esc)",children:e.jsx(S,{size:20})})]})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center overflow-hidden relative",children:R()})]})};export{F as default};
